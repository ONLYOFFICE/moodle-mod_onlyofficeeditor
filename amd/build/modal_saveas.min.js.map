{"version":3,"file":"modal_saveas.min.js","sources":["../src/modal_saveas.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Contain the logic for the add save as modal.\n *\n * @module    mod_onlyofficeeditor/modal_saveas\n * @copyright  2024 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery', 'core/notification', 'core/custom_interaction_events', 'core/modal', 'core/modal_registry', 'core/templates'],\n    function($, Notification, CustomEvents, Modal, ModalRegistry, Templates) {\n\n        var displayNotification = function(error, type) {\n            require(['core/notification'], function(notification) {\n                require(['core/str'], function(str) {\n                    var errorIsAvailable = str.get_string(error, 'onlyofficeeditor');\n                    $.when(errorIsAvailable).done(function(localizedStr) {\n                        notification.addNotification({\n                            message: localizedStr,\n                            type: type\n                        });\n                    });\n                });\n            });\n        };\n\n        var SELECTORS = {\n            LOADING_ICON_CONTAINER: '[data-region=\"overlay-icon-container\"]',\n            SECTION: '.onlyofficeeditor-saveas-section',\n            BUTTON: '#onlyofficeeditor-saveas-button',\n            CONTAINER: '.container'\n        };\n\n        /**\n         * Show the loading spinner.\n         *\n         * @param  {jquery} body The body element.\n         */\n        var showLoadingIcon = function(body) {\n            body.find(SELECTORS.LOADING_ICON_CONTAINER).removeClass('hidden');\n        };\n\n        /**\n         * Hide the loading spinner.\n         *\n         * @param  {jquery} body The body element.\n         */\n        var hideLoadingIcon = function(body) {\n            body.find(SELECTORS.LOADING_ICON_CONTAINER).addClass('hidden');\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalSaveas = function(root) {\n            Modal.call(this, root);\n            this.selectedSection = null;\n            this.saveAsData = null;\n            this.CMID = null;\n            this.courseid = null;\n        };\n\n        ModalSaveas.TYPE = 'mod_onlyofficeeditor-modal_saveas';\n        ModalSaveas.prototype = Object.create(Modal.prototype);\n        ModalSaveas.prototype.constructor = ModalSaveas;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalSaveas.prototype.registerEventListeners = function() {\n            Modal.prototype.registerEventListeners.call(this);\n\n            var modal = this;\n            this.getModal().on('click', SELECTORS.SECTION, function(e) {\n                var selected = modal.selectedSection;\n                if (selected !== null) {\n                    var previousSection = modal.getBody().find('#saveas-section-' + selected)[0];\n                    previousSection.classList.remove('onlyofficeeditor-saveas-section-selected');\n                }\n                var button = modal.getFooter().find(SELECTORS.BUTTON)[0];\n                button.removeAttribute('disabled');\n                e.target.classList.add('onlyofficeeditor-saveas-section-selected');\n                modal.selectedSection = parseInt(e.target.id.split('-')[2]);\n            }).bind(this);\n\n            this.getModal().on('click', SELECTORS.BUTTON, function() {\n                modal.saveAsData.section = modal.selectedSection;\n                $.ajax(M.cfg.wwwroot +\n                    `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=saveas&cmid=${modal.CMID}`, {\n                    type: 'POST',\n                    dataType: 'json',\n                    data: modal.saveAsData,\n                }).done(() => {\n                    displayNotification('saveassuccess', 'success');\n                }).fail(() => {\n                    displayNotification('saveaserror', 'error');\n                }).always(() => {\n                    modal.hide();\n                });\n            }).bind(this);\n        };\n\n        ModalSaveas.prototype.renderSections = function(body, cmid, courseid) {\n            var modal = this;\n            showLoadingIcon(body);\n            $.ajax(M.cfg.wwwroot + `/mod/onlyofficeeditor/onlyofficeeditorapi.php?apiType=sections&cmid=${cmid}`, {\n                type: 'GET',\n                dataType: 'json',\n                data: {courseid: courseid}\n            }).done((response) => {\n                var sections = response.sections;\n                // eslint-disable-next-line promise/catch-or-return\n                Templates.render('mod_onlyofficeeditor/modal_saveas_sections_list', {sections: sections})\n                    .then((html, js) => {\n                        var container = body.find(SELECTORS.CONTAINER)[0];\n                        Templates.replaceNode(container, html, js);\n                        return;\n                    })\n                    .always(() => {\n                        hideLoadingIcon(body);\n                    });\n            }).fail(() => {\n                modal.hide();\n                displayNotification('saveaserror', 'error');\n            });\n        };\n\n        /**\n         * Override the modal show function to load the form when this modal is first shown.\n         *\n         * @method show\n         */\n        ModalSaveas.prototype.show = function() {\n            Modal.prototype.show.call(this);\n\n            if (this.selectedSection !== null) {\n                this.selectedSection = null;\n            }\n            var button = this.getFooter().find(SELECTORS.BUTTON)[0];\n            button.setAttribute('disabled', '');\n        };\n\n        if (!ModalRegistry.get(ModalSaveas.TYPE)) {\n            ModalRegistry.register(ModalSaveas.TYPE, ModalSaveas, 'mod_onlyofficeeditor/modal_saveas');\n        }\n\n        return ModalSaveas;\n    });\n"],"names":["define","$","Notification","CustomEvents","Modal","ModalRegistry","Templates","displayNotification","error","type","require","notification","str","errorIsAvailable","get_string","when","done","localizedStr","addNotification","message","SELECTORS","ModalSaveas","root","call","this","selectedSection","saveAsData","CMID","courseid","TYPE","prototype","Object","create","constructor","registerEventListeners","modal","getModal","on","e","selected","getBody","find","classList","remove","getFooter","removeAttribute","target","add","parseInt","id","split","bind","section","ajax","M","cfg","wwwroot","dataType","data","fail","always","hide","renderSections","body","cmid","removeClass","showLoadingIcon","response","sections","render","then","html","js","container","replaceNode","addClass","hideLoadingIcon","show","setAttribute","get","register"],"mappings":";;;;;;;AAsBAA,2CAAO,CAAC,SAAU,oBAAqB,iCAAkC,aAAc,sBAAuB,mBAC1G,SAASC,EAAGC,aAAcC,aAAcC,MAAOC,cAAeC,eAEtDC,oBAAsB,SAASC,MAAOC,MACtCC,QAAQ,CAAC,sBAAsB,SAASC,cACpCD,QAAQ,CAAC,aAAa,SAASE,SACvBC,iBAAmBD,IAAIE,WAAWN,MAAO,oBAC7CP,EAAEc,KAAKF,kBAAkBG,MAAK,SAASC,cACnCN,aAAaO,gBAAgB,CACzBC,QAASF,aACTR,KAAMA,iBAOtBW,iCACwB,yCADxBA,kBAES,mCAFTA,iBAGQ,kCAHRA,oBAIW,aA0BXC,YAAc,SAASC,MACvBlB,MAAMmB,KAAKC,KAAMF,WACZG,gBAAkB,UAClBC,WAAa,UACbC,KAAO,UACPC,SAAW,aAGpBP,YAAYQ,KAAO,qCACnBR,YAAYS,UAAYC,OAAOC,OAAO5B,MAAM0B,YACtBG,YAAcZ,YAOpCA,YAAYS,UAAUI,uBAAyB,WAC3C9B,MAAM0B,UAAUI,uBAAuBX,KAAKC,UAExCW,MAAQX,UACPY,WAAWC,GAAG,QAASjB,mBAAmB,SAASkB,OAChDC,SAAWJ,MAAMV,gBACJ,OAAbc,UACsBJ,MAAMK,UAAUC,KAAK,mBAAqBF,UAAU,GAC1DG,UAAUC,OAAO,4CAExBR,MAAMS,YAAYH,KAAKrB,kBAAkB,GAC/CyB,gBAAgB,YACvBP,EAAEQ,OAAOJ,UAAUK,IAAI,4CACvBZ,MAAMV,gBAAkBuB,SAASV,EAAEQ,OAAOG,GAAGC,MAAM,KAAK,OACzDC,KAAK3B,WAEHY,WAAWC,GAAG,QAASjB,kBAAkB,WAC1Ce,MAAMT,WAAW0B,QAAUjB,MAAMV,gBACjCxB,EAAEoD,KAAKC,EAAEC,IAAIC,oFAC4DrB,MAAMR,MAAQ,CACnFlB,KAAM,OACNgD,SAAU,OACVC,KAAMvB,MAAMT,aACbV,MAAK,WACJT,oBAAoB,gBAAiB,cACtCoD,MAAK,WACJpD,oBAAoB,cAAe,YACpCqD,QAAO,WACNzB,MAAM0B,aAEXV,KAAK3B,OAGZH,YAAYS,UAAUgC,eAAiB,SAASC,KAAMC,KAAMpC,cACpDO,MAAQX,MArEM,SAASuC,MAC3BA,KAAKtB,KAAKrB,kCAAkC6C,YAAY,UAqExDC,CAAgBH,MAChB9D,EAAEoD,KAAKC,EAAEC,IAAIC,sFAAiFQ,MAAQ,CAClGvD,KAAM,MACNgD,SAAU,OACVC,KAAM,CAAC9B,SAAUA,YAClBZ,MAAK,SAACmD,cACDC,SAAWD,SAASC,SAExB9D,UAAU+D,OAAO,kDAAmD,CAACD,SAAUA,WAC1EE,MAAK,SAACC,KAAMC,QACLC,UAAYV,KAAKtB,KAAKrB,qBAAqB,GAC/Cd,UAAUoE,YAAYD,UAAWF,KAAMC,OAG1CZ,QAAO,YA3EE,SAASG,MAC3BA,KAAKtB,KAAKrB,kCAAkCuD,SAAS,UA2EzCC,CAAgBb,YAEzBJ,MAAK,WACJxB,MAAM0B,OACNtD,oBAAoB,cAAe,aAS3Cc,YAAYS,UAAU+C,KAAO,WACzBzE,MAAM0B,UAAU+C,KAAKtD,KAAKC,MAEG,OAAzBA,KAAKC,uBACAA,gBAAkB,MAEdD,KAAKoB,YAAYH,KAAKrB,kBAAkB,GAC9C0D,aAAa,WAAY,KAG/BzE,cAAc0E,IAAI1D,YAAYQ,OAC/BxB,cAAc2E,SAAS3D,YAAYQ,KAAMR,YAAa,qCAGnDA"}