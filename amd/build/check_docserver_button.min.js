/**
 * @module     mod_onlyofficeeditor/check_docserver_button
 * @copyright  2025 Ascensio System SIA <integration@onlyoffice.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 **/
define("mod_onlyofficeeditor/check_docserver_button",["core/notification","core/str","mod_onlyofficeeditor/repository","mod_onlyofficeeditor/url_validator"],(function(Notification,Str,Repository,UrlValidator){const fields={docserverurl:"documentserverurl",secret:"documentserversecret",jwtheader:"jwtheader",internalurl:"documentserverinternal",storageurl:"storageurl",disableverifyssl:"disable_verify_ssl"},validationElements=[],checkDocumentServerConnection=async event=>{event.preventDefault();const docsurl=document.getElementById("id_s_onlyofficeeditor_documentserverurl").value.trim(),connectionerrormessage=await Str.get_string("connectionerror","onlyofficeeditor"),errors=await validateDocumentServerUrl(docsurl);if(errors.length>0){clearValidationOutput(),Notification.addNotification({message:connectionerrormessage,type:"error"});for(const error of errors)highlightErrorField(error)}else await Repository.checkDocumentServerConnection(docsurl,document.getElementById("id_s_onlyofficeeditor_documentserversecret").value,document.getElementById("id_s_onlyofficeeditor_jwtheader").value,document.getElementById("id_s_onlyofficeeditor_documentserverinternal").value,document.getElementById("id_s_onlyofficeeditor_storageurl").value,document.getElementById("id_s_onlyofficeeditor_disable_verify_ssl").checked).then((async response=>{if(clearValidationOutput(),"success"===response.status)Notification.addNotification({message:"Connection is stable.",type:"success"});else if("error"===response.status){Notification.addNotification({message:connectionerrormessage,type:"error"});for(const error of response.errors)"general"===error.field?Notification.addNotification({message:error.message,type:"error"}):highlightErrorField(error)}})).catch((async error=>{console.error("Error checking Document Server connection:",error),Notification.addNotification({message:await Str.get_string("connectionerror:unexpected","onlyofficeeditor"),type:"error"})}))},highlightErrorField=error=>{const fieldForm=document.getElementById("admin-"+fields[error.field]),fieldSetting=fieldForm?fieldForm.querySelector(".form-setting"):null;if(fieldSetting){const errorElement=document.createElement("div");errorElement.innerHTML='<span class="error">'+error.message+"</span>",fieldSetting.prepend(errorElement),validationElements.push(errorElement)}},clearValidationOutput=()=>{for(const element of validationElements)element.remove();validationElements.length=0;document.getElementById("user-notifications").innerHTML=""},validateDocumentServerUrl=async url=>{let error=[];return url?UrlValidator.isValidUrl(url)?UrlValidator.isMixedContent(url)&&error.push({field:"docserverurl",message:await Str.get_string("validationerror:mixedcontent","onlyofficeeditor")}):error.push({field:"docserverurl",message:await Str.get_string("validationerror:invalidurl","onlyofficeeditor")}):error.push({field:"docserverurl",message:await Str.get_string("validationerror:emptyurl","onlyofficeeditor")}),error};return{init:function(){const checkButton=document.querySelector("button[data-action='check-documentserver-connection']");checkButton&&checkButton.addEventListener("click",checkDocumentServerConnection)}}}));

//# sourceMappingURL=check_docserver_button.min.js.map