{"version":3,"file":"docs_integration_api.min.js","sources":["../src/docs_integration_api.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module mod_onlyofficeeditor/docs_integration_api\n * @copyright  2025 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\n/* eslint-disable no-console, no-undef */\ndefine([], function() {\n    const DOCS_API_PATH = 'web-apps/apps/api/documents/api.js';\n    const SCRIPT_ID = 'onlyofficeeditor-docsapi';\n\n    /**\n     * Load the ONLYOFFICE Document Server API script.\n     *\n     * @param {String} url The URL to the document server\n     * @return {Promise} A promise that resolves when the API is loaded\n     */\n    const loadDocsApi = function(url) {\n        // eslint-disable-next-line consistent-return\n        return new Promise(function(resolve, reject) {\n            try {\n                // If DocsAPI is already loaded, resolve immediately\n                if (typeof DocsAPI !== \"undefined\" && DocsAPI !== null) {\n                    return resolve(null);\n                }\n\n                if (!url || url.trim() === '') {\n                    return reject('Document server URL is not provided');\n                }\n\n                const existingScript = document.getElementById(SCRIPT_ID);\n\n                if (existingScript) {\n                    // If the script element is found, wait for it to load.\n                    let intervalHandler = setInterval(() => {\n                        const loading = existingScript.getAttribute(\"loading\");\n                        if (loading) {\n                            // If the download is not completed, continue to wait.\n                            return;\n                        } else {\n                            // If the download is completed, stop the wait.\n                            clearInterval(intervalHandler);\n\n                            // If DocsAPI is defined, after loading return resolve.\n                            if (typeof DocsAPI !== \"undefined\" && DocsAPI !== null) {\n                                resolve(null);\n                            }\n\n                            // If DocsAPI is not defined, delete the existing script and create a new one.\n                            const script = _createScriptTag(SCRIPT_ID, url, resolve, reject);\n                            existingScript.remove();\n                            document.body.appendChild(script);\n                        }\n                    }, 500);\n                } else {\n                    // If the script element is not found, create it.\n                    const script = _createScriptTag(SCRIPT_ID, url, resolve, reject);\n                    document.body.appendChild(script);\n                }\n            } catch (error) {\n                console.error('Error loading Document Server API:', error);\n                return reject(error);\n            }\n        });\n    };\n\n    const _createScriptTag = (id, url, resolve, reject) => {\n        const script = document.createElement(\"script\");\n\n        script.id = id;\n        script.type = \"text/javascript\";\n        script.src = url.endsWith(\"/\") ? url + DOCS_API_PATH : url + \"/\" + DOCS_API_PATH;\n        script.async = true;\n\n        script.onload = () => {\n            // Remove attribute loading after loading is complete.\n            script.removeAttribute(\"loading\");\n\n            resolve(null);\n        };\n        script.onerror = (error) => {\n            // Remove attribute loading after loading is complete.\n            script.removeAttribute(\"loading\");\n            reject(error);\n        };\n\n        script.setAttribute(\"loading\", \"\");\n\n        return script;\n    };\n\n    const removeDocsApi = function() {\n        return new Promise(function(resolve, reject) {\n            try {\n                const script = document.getElementById(SCRIPT_ID);\n                // Remove the script element from the document.\n                if (script) {\n                    script.remove();\n                }\n\n                // If DocsAPI is not loaded, resolve immediately.\n                if (typeof DocsAPI === \"undefined\" || DocsAPI === null) {\n                    return resolve(null);\n                }\n\n                // Set DocsAPI to null to indicate it has been removed.\n                DocsAPI = null;\n                return resolve(null);\n            } catch (error) {\n                console.error('Error removing Document Server API:', error);\n                return reject(error);\n            }\n        });\n    };\n\n    return {\n        loadDocsApi,\n        removeDocsApi\n    };\n});\n/* eslint-enable no-console, no-undef */"],"names":["define","SCRIPT_ID","_createScriptTag","id","url","resolve","reject","script","document","createElement","type","src","endsWith","async","onload","removeAttribute","onerror","error","setAttribute","loadDocsApi","Promise","DocsAPI","trim","existingScript","getElementById","intervalHandler","setInterval","getAttribute","clearInterval","remove","body","appendChild","console","removeDocsApi"],"mappings":";;;;;AAqBAA,mDAAO,IAAI,iBAEDC,UAAY,2BAyDZC,iBAAmB,CAACC,GAAIC,IAAKC,QAASC,gBAClCC,OAASC,SAASC,cAAc,iBAEtCF,OAAOJ,GAAKA,GACZI,OAAOG,KAAO,kBACdH,OAAOI,IAAMP,IAAIQ,SAAS,KAAOR,IA/Df,qCA+DqCA,IAAAA,sCACvDG,OAAOM,OAAQ,EAEfN,OAAOO,OAAS,KAEZP,OAAOQ,gBAAgB,WAEvBV,QAAQ,OAEZE,OAAOS,QAAWC,QAEdV,OAAOQ,gBAAgB,WACvBT,OAAOW,QAGXV,OAAOW,aAAa,UAAW,IAExBX,cA2BJ,CACHY,YAnGgB,SAASf,YAElB,IAAIgB,SAAQ,SAASf,QAASC,eAGN,oBAAZe,SAAuC,OAAZA,eAC3BhB,QAAQ,UAGdD,KAAsB,KAAfA,IAAIkB,cACLhB,OAAO,6CAGZiB,eAAiBf,SAASgB,eAAevB,cAE3CsB,eAAgB,KAEZE,gBAAkBC,aAAY,SACdH,eAAeI,aAAa,WAIrC,CAEHC,cAAcH,iBAGS,oBAAZJ,SAAuC,OAAZA,SAClChB,QAAQ,YAINE,OAASL,iBAAiBD,UAAWG,IAAKC,QAASC,QACzDiB,eAAeM,SACfrB,SAASsB,KAAKC,YAAYxB,WAE/B,SACA,OAEGA,OAASL,iBAAiBD,UAAWG,IAAKC,QAASC,QACzDE,SAASsB,KAAKC,YAAYxB,SAEhC,MAAOU,cACLe,QAAQf,MAAM,qCAAsCA,OAC7CX,OAAOW,YAwDtBgB,cA1BkB,kBACX,IAAIb,SAAQ,SAASf,QAASC,kBAEvBC,OAASC,SAASgB,eAAevB,kBAEnCM,QACAA,OAAOsB,SAIY,oBAAZR,SAAuC,OAAZA,QAC3BhB,QAAQ,OAInBgB,QAAU,KACHhB,QAAQ,OACjB,MAAOY,cACLe,QAAQf,MAAM,sCAAuCA,OAC9CX,OAAOW"}